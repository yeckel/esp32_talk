diff --git a/src/codec2.c b/src/codec2.c
index b27626a..bae3357 100644
--- a/src/codec2.c
+++ b/src/codec2.c
@@ -61,6 +61,13 @@
 void analyse_one_frame(struct CODEC2 *c2, MODEL *model, short speech[]);
 void synthesise_one_frame(struct CODEC2 *c2, short speech[], MODEL *model,
                           COMP Aw[], float gain);
+
+/* Shared scratch buffer for encode (Sw) and decode (Aw) – never concurrent */
+static COMP codec2_comp_scratch[FFT_ENC];
+
+/* Shared scratch for encode-Fw / decode-postfilter (never concurrent) */
+char codec2_scratch2[CODEC2_SCRATCH2_SIZE];
+
 void codec2_encode_3200(struct CODEC2 *c2, unsigned char *bits, short speech[]);
 void codec2_decode_3200(struct CODEC2 *c2, short speech[],
                         const unsigned char *bits);
@@ -112,13 +119,16 @@ struct CODEC2 *codec2_create(int mode) {
   // we test if the desired mode is enabled at compile time
   // and return NULL if not
 
-  if (false == (CODEC2_MODE_ACTIVE(CODEC2_MODE_3200, mode) ||
-                CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, mode) ||
-                CODEC2_MODE_ACTIVE(CODEC2_MODE_1600, mode) ||
-                CODEC2_MODE_ACTIVE(CODEC2_MODE_1400, mode) ||
-                CODEC2_MODE_ACTIVE(CODEC2_MODE_1300, mode) ||
-                CODEC2_MODE_ACTIVE(CODEC2_MODE_1200, mode) ||
-                CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, mode))) {
+  if (false == (CODEC2_MODE_ACTIVE(CODEC2_MODE_3200, mode)
+#ifndef CODEC2_MODE_3200_ONLY
+                || CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, mode)
+                || CODEC2_MODE_ACTIVE(CODEC2_MODE_1600, mode)
+                || CODEC2_MODE_ACTIVE(CODEC2_MODE_1400, mode)
+                || CODEC2_MODE_ACTIVE(CODEC2_MODE_1300, mode)
+                || CODEC2_MODE_ACTIVE(CODEC2_MODE_1200, mode)
+                || CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, mode)
+#endif
+  )) {
     return NULL;
   }
 
@@ -207,6 +217,7 @@ struct CODEC2 *codec2_create(int mode) {
 
   /* newamp1 initialisation */
 
+#ifndef CODEC2_MODE_3200_ONLY
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode)) {
     mel_sample_freqs_kHz(c2->rate_K_sample_freqs_kHz, NEWAMP1_K, ftomel(200.0),
                          ftomel(3700.0));
@@ -221,6 +232,7 @@ struct CODEC2 *codec2_create(int mode) {
     c2->phase_fft_fwd_cfg = codec2_fft_alloc(NEWAMP1_PHASE_NFFT, 0, NULL, NULL);
     c2->phase_fft_inv_cfg = codec2_fft_alloc(NEWAMP1_PHASE_NFFT, 1, NULL, NULL);
   }
+#endif /* !CODEC2_MODE_3200_ONLY */
 
   c2->fmlfeat = NULL;
   c2->fmlmodel = NULL;
@@ -237,6 +249,7 @@ struct CODEC2 *codec2_create(int mode) {
     c2->decode = codec2_decode_3200;
   }
 
+#ifndef CODEC2_MODE_3200_ONLY
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, c2->mode)) {
     c2->encode = codec2_encode_2400;
     c2->decode = codec2_decode_2400;
@@ -266,6 +279,7 @@ struct CODEC2 *codec2_create(int mode) {
     c2->encode = codec2_encode_700c;
     c2->decode = codec2_decode_700c;
   }
+#endif /* !CODEC2_MODE_3200_ONLY */
 
   return c2;
 }
@@ -287,10 +301,12 @@ void codec2_destroy(struct CODEC2 *c2) {
   codec2_fft_free(c2->fft_fwd_cfg);
   codec2_fftr_free(c2->fftr_fwd_cfg);
   codec2_fftr_free(c2->fftr_inv_cfg);
+#ifndef CODEC2_MODE_3200_ONLY
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode)) {
     codec2_fft_free(c2->phase_fft_fwd_cfg);
     codec2_fft_free(c2->phase_fft_inv_cfg);
   }
+#endif
   FREE(c2->Pn);
   FREE(c2->Sn);
   FREE(c2->w);
@@ -310,12 +326,14 @@ void codec2_destroy(struct CODEC2 *c2) {
 
 int codec2_bits_per_frame(struct CODEC2 *c2) {
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_3200, c2->mode)) return 64;
+#ifndef CODEC2_MODE_3200_ONLY
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, c2->mode)) return 48;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1600, c2->mode)) return 64;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1400, c2->mode)) return 56;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1300, c2->mode)) return 52;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1200, c2->mode)) return 48;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode)) return 28;
+#endif
 
   return 0; /* shouldn't get here */
 }
@@ -347,12 +365,14 @@ int codec2_bytes_per_frame(struct CODEC2 *c2) {
 
 int codec2_samples_per_frame(struct CODEC2 *c2) {
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_3200, c2->mode)) return 160;
+#ifndef CODEC2_MODE_3200_ONLY
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, c2->mode)) return 160;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1600, c2->mode)) return 320;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1400, c2->mode)) return 320;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1300, c2->mode)) return 320;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_1200, c2->mode)) return 320;
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode)) return 320;
+#endif
   return 0; /* shouldn't get here */
 }
 
@@ -488,7 +508,8 @@ void codec2_decode_3200(struct CODEC2 *c2, short speech[],
   float ak[2][LPC_ORD + 1];
   int i, j;
   unsigned int nbit = 0;
-  COMP Aw[FFT_ENC];
+  static COMP *Aw_buf = codec2_comp_scratch;  /* shares with Sw – never concurrent */
+  COMP *Aw = Aw_buf;
 
   assert(c2 != NULL);
 
@@ -546,6 +567,8 @@ void codec2_decode_3200(struct CODEC2 *c2, short speech[],
   for (i = 0; i < LPC_ORD; i++) c2->prev_lsps_dec[i] = lsps[1][i];
 }
 
+#ifndef CODEC2_MODE_3200_ONLY
+
 /*---------------------------------------------------------------------------*\
 
   FUNCTION....: codec2_encode_2400
@@ -1574,6 +1597,8 @@ float codec2_energy_700c(struct CODEC2 *c2, const unsigned char *bits) {
   return POW10F(mean / 10.0);
 }
 
+#endif /* !CODEC2_MODE_3200_ONLY */
+
 /*---------------------------------------------------------------------------*\
 
   FUNCTION....: codec2_get_energy()
@@ -1586,13 +1611,16 @@ float codec2_energy_700c(struct CODEC2 *c2, const unsigned char *bits) {
 
 float codec2_get_energy(struct CODEC2 *c2, const unsigned char *bits) {
   assert(c2 != NULL);
-  assert((CODEC2_MODE_ACTIVE(CODEC2_MODE_3200, c2->mode)) ||
-         (CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, c2->mode)) ||
-         (CODEC2_MODE_ACTIVE(CODEC2_MODE_1600, c2->mode)) ||
-         (CODEC2_MODE_ACTIVE(CODEC2_MODE_1400, c2->mode)) ||
-         (CODEC2_MODE_ACTIVE(CODEC2_MODE_1300, c2->mode)) ||
-         (CODEC2_MODE_ACTIVE(CODEC2_MODE_1200, c2->mode)) ||
-         (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode)));
+  assert((CODEC2_MODE_ACTIVE(CODEC2_MODE_3200, c2->mode))
+#ifndef CODEC2_MODE_3200_ONLY
+         || (CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, c2->mode))
+         || (CODEC2_MODE_ACTIVE(CODEC2_MODE_1600, c2->mode))
+         || (CODEC2_MODE_ACTIVE(CODEC2_MODE_1400, c2->mode))
+         || (CODEC2_MODE_ACTIVE(CODEC2_MODE_1300, c2->mode))
+         || (CODEC2_MODE_ACTIVE(CODEC2_MODE_1200, c2->mode))
+         || (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode))
+#endif
+  );
   MODEL model;
   float xq_dec[2] = {};
   int e_index, WoE_index;
@@ -1604,6 +1632,7 @@ float codec2_get_energy(struct CODEC2 *c2, const unsigned char *bits) {
     e_index = unpack(bits, &nbit, E_BITS);
     e = decode_energy(e_index, E_BITS);
   }
+#ifndef CODEC2_MODE_3200_ONLY
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_2400, c2->mode)) {
     nbit = 1 + 1;
     WoE_index = unpack(bits, &nbit, WO_E_BITS);
@@ -1632,6 +1661,7 @@ float codec2_get_energy(struct CODEC2 *c2, const unsigned char *bits) {
   if (CODEC2_MODE_ACTIVE(CODEC2_MODE_700C, c2->mode)) {
     e = codec2_energy_700c(c2, bits);
   }
+#endif /* !CODEC2_MODE_3200_ONLY */
 
   return e;
 }
@@ -1692,7 +1722,7 @@ void synthesise_one_frame(struct CODEC2 *c2, short speech[], MODEL *model,
 \*---------------------------------------------------------------------------*/
 
 void analyse_one_frame(struct CODEC2 *c2, MODEL *model, short speech[]) {
-  COMP Sw[FFT_ENC];
+  COMP *Sw = codec2_comp_scratch;  /* shares with Aw – never concurrent */
   float pitch;
   int i;
   int n_samp = c2->n_samp;
@@ -1713,6 +1743,8 @@ void analyse_one_frame(struct CODEC2 *c2, MODEL *model, short speech[]) {
   /* estimate model parameters */
   two_stage_pitch_refinement(&c2->c2const, model, Sw);
 
+  /* NOTE: Sw is pre-allocated in c2->Sw_scratch, no free needed */
+
   /* estimate phases when doing ML experiments */
   if (c2->fmlfeat != NULL)
     estimate_amplitudes(model, Sw, c2->W, 1);
diff --git a/src/codec2_internal.h b/src/codec2_internal.h
index 32cd7eb..14eb53e 100644
--- a/src/codec2_internal.h
+++ b/src/codec2_internal.h
@@ -100,4 +100,14 @@ struct CODEC2 {
 void analyse_one_frame(struct CODEC2 *c2, MODEL *model, short speech[]);
 void synthesise_one_frame(struct CODEC2 *c2, short speech[], MODEL *model,
                           COMP Aw[], float gain);
+
+/*
+ * Shared scratch area for buffers that are exclusive to encode OR decode.
+ * Encode path uses it for Fw (nlp, 4096 bytes).
+ * Decode path uses it for lpc_post_filter / aks_to_M2 scratch (8204 bytes).
+ * Size = max(4096, 8204) = 8204 bytes, saving ~4 KB vs separate statics.
+ */
+#define CODEC2_SCRATCH2_SIZE 8204
+extern char codec2_scratch2[CODEC2_SCRATCH2_SIZE];
+
 #endif
diff --git a/src/nlp.c b/src/nlp.c
index 53cf040..43ddc96 100644
--- a/src/nlp.c
+++ b/src/nlp.c
@@ -27,6 +27,7 @@
 
 #include "nlp.h"
 
+#include "codec2_internal.h"
 #include "codec2_fft.h"
 #include "defines.h"
 #include "dump.h"
@@ -217,7 +218,7 @@ float nlp(
 ) {
   NLP *nlp;
   float notch;          /* current notch filter output          */
-  COMP Fw[PE_FFT_SIZE]; /* DFT of squared signal (input/output) */
+  COMP *Fw = (COMP *)codec2_scratch2;  /* shared scratch – encode only */
   float gmax;
   int gmax_bin;
   int m, i, j;
diff --git a/src/quantise.c b/src/quantise.c
index da1d821..9cd6edd 100644
--- a/src/quantise.c
+++ b/src/quantise.c
@@ -26,6 +26,7 @@
 
 #include "quantise.h"
 
+#include "codec2_internal.h"
 #include <assert.h>
 #include <ctype.h>
 #include <math.h>
@@ -61,11 +62,15 @@ float speech_to_uq_lsps(float lsp[], float ak[], float Sn[], float w[],
 
 \*---------------------------------------------------------------------------*/
 
+#ifndef CODEC2_MODE_3200_ONLY
 int lsp_bits(int i) { return lsp_cb[i].log2m; }
+#endif
 
 int lspd_bits(int i) { return lsp_cbd[i].log2m; }
 
+#ifndef CODEC2_MODE_3200_ONLY
 int lsp_pred_vq_bits(int i) { return lsp_cbjmv[i].log2m; }
+#endif /* !CODEC2_MODE_3200_ONLY */
 
 /*---------------------------------------------------------------------------*\
 
@@ -183,6 +188,7 @@ void decode_lspds_scalar(float lsp_[], int indexes[], int order) {
 #define MIN(a, b) ((a) < (b) ? (a) : (b))
 #define MAX_ENTRIES 16384
 
+#ifndef CODEC2_MODE_3200_ONLY
 void compute_weights(const float *x, float *w, int ndim) {
   int i;
   w[0] = MIN(x[0], x[1] - x[0]);
@@ -262,6 +268,7 @@ void lspjmv_quantise(float *x, float *xq, int order) {
     xq[2 * i + 1] += codebook3[order * n3 / 2 + i];
   }
 }
+#endif /* !CODEC2_MODE_3200_ONLY */
 
 int check_lsp_order(float lsp[], int order) {
   int i;
@@ -323,9 +330,10 @@ void lpc_post_filter(codec2_fftr_cfg fftr_fwd_cfg, float Pw[], float ak[],
                      int order, int dump, float beta, float gamma,
                      int bass_boost, float E) {
   int i;
-  float x[FFT_ENC];          /* input to FFTs                */
-  COMP Ww[FFT_ENC / 2 + 1];  /* weighting spectrum           */
-  float Rw[FFT_ENC / 2 + 1]; /* R = WA                       */
+  /* Scratch buffers carved from codec2_scratch2 (decode-only, shared with Fw) */
+  float *x  = (float *)codec2_scratch2;                                   /* [FFT_ENC]       = 2048 bytes @ offset 0    */
+  COMP  *Ww = (COMP *)(codec2_scratch2 + FFT_ENC * sizeof(float));         /* [FFT_ENC/2 + 1] = 2056 bytes @ offset 2048 */
+  float *Rw = (float *)(codec2_scratch2 + FFT_ENC * sizeof(float) + (FFT_ENC / 2 + 1) * sizeof(COMP)); /* [FFT_ENC/2+1] = 1028 bytes @ offset 4104 */
   float e_before, e_after, gain;
   float Pfw;
   float max_Rw, min_Rw;
@@ -447,12 +455,11 @@ void aks_to_M2(codec2_fftr_cfg fftr_fwd_cfg, float ak[], /* LPC's */
 
   /* Determine DFT of A(exp(jw)) --------------------------------------------*/
   {
-    float a[FFT_ENC]; /* input to FFT for power spectrum */
-
-    for (i = 0; i < FFT_ENC; i++) {
-      a[i] = 0.0;
-    }
-
+    /* Scratch buffer carved from codec2_scratch2 (decode-only) */
+    float *a = (float *)(codec2_scratch2 + FFT_ENC * sizeof(float)
+                         + (FFT_ENC / 2 + 1) * sizeof(COMP)
+                         + (FFT_ENC / 2 + 1) * sizeof(float)); /* [FFT_ENC] = 2048 bytes @ offset 5132 */
+    for (i = 0; i < FFT_ENC; i++) a[i] = 0.0;
     for (i = 0; i <= order; i++) a[i] = ak[i];
     codec2_fftr(fftr_fwd_cfg, a, Aw);
   }
@@ -460,7 +467,11 @@ void aks_to_M2(codec2_fftr_cfg fftr_fwd_cfg, float ak[], /* LPC's */
 
   /* Determine power spectrum P(w) = E/(A(exp(jw))^2 ------------------------*/
 
-  float Pw[FFT_ENC / 2];
+  /* Scratch buffer carved from codec2_scratch2 (decode-only) */
+  float *Pw = (float *)(codec2_scratch2 + FFT_ENC * sizeof(float)
+                        + (FFT_ENC / 2 + 1) * sizeof(COMP)
+                        + (FFT_ENC / 2 + 1) * sizeof(float)
+                        + FFT_ENC * sizeof(float));  /* [FFT_ENC/2] = 1024 bytes @ offset 7180 */
 
 #ifndef FDV_ARM_MATH
   for (i = 0; i < FFT_ENC / 2; i++) {
@@ -692,6 +703,8 @@ float speech_to_uq_lsps(float lsp[], float ak[], float Sn[], float w[],
   return E;
 }
 
+#ifndef CODEC2_MODE_3200_ONLY
+
 /*---------------------------------------------------------------------------*\
 
   FUNCTION....: encode_lsps_scalar()
@@ -827,6 +840,8 @@ void decode_lsps_vq(int *indexes, float *xq, int order, int stages) {
   }
 }
 
+#endif /* !CODEC2_MODE_3200_ONLY */
+
 /*---------------------------------------------------------------------------*\
 
   FUNCTION....: bw_expand_lsps()
diff --git a/src/quantise.h b/src/quantise.h
index 08d5532..d5a233b 100644
--- a/src/quantise.h
+++ b/src/quantise.h
@@ -57,17 +57,23 @@ int encode_Wo(C2CONST *c2const, float Wo, int bits);
 float decode_Wo(C2CONST *c2const, int index, int bits);
 int encode_log_Wo(C2CONST *c2const, float Wo, int bits);
 float decode_log_Wo(C2CONST *c2const, int index, int bits);
+#ifndef CODEC2_MODE_3200_ONLY
 void encode_lsps_scalar(int indexes[], float lsp[], int order);
 void decode_lsps_scalar(float lsp[], int indexes[], int order);
+#endif
 void encode_lspds_scalar(int indexes[], float lsp[], int order);
 void decode_lspds_scalar(float lsp[], int indexes[], int order);
 
+#ifndef CODEC2_MODE_3200_ONLY
 void encode_lsps_vq(int *indexes, float *x, float *xq, int order);
 void decode_lsps_vq(int *indexes, float *xq, int order, int stages);
+#endif
 
 long quantise(const float *cb, float vec[], float w[], int k, int m, float *se);
+#ifndef CODEC2_MODE_3200_ONLY
 void lspvq_quantise(float lsp[], float lsp_[], int order);
 void lspjmv_quantise(float lsps[], float lsps_[], int order);
+#endif
 
 void quantise_WoE(C2CONST *c2const, MODEL *model, float *e, float xq[]);
 int encode_WoE(MODEL *model, float e, float xq[]);
@@ -85,9 +91,13 @@ int unpack(const unsigned char *bits, unsigned int *nbit,
 int unpack_natural_or_gray(const unsigned char *bits, unsigned int *nbit,
                            unsigned int index_bits, unsigned int gray);
 
+#ifndef CODEC2_MODE_3200_ONLY
 int lsp_bits(int i);
+#endif
 int lspd_bits(int i);
+#ifndef CODEC2_MODE_3200_ONLY
 int lsp_pred_vq_bits(int i);
+#endif
 
 void apply_lpc_correction(MODEL *model);
 float speech_to_uq_lsps(float lsp[], float ak[], float Sn[], float w[],
diff --git a/src/sine.c b/src/sine.c
index 814c269..8a2184c 100644
--- a/src/sine.c
+++ b/src/sine.c
@@ -102,7 +102,8 @@ C2CONST c2const_create(int Fs, float framelength_s) {
 void make_analysis_window(C2CONST *c2const, codec2_fft_cfg fft_fwd_cfg,
                           float w[], float W[]) {
   float m;
-  COMP wshift[FFT_ENC];
+  /* Heap-allocate to avoid 8 KB stack hit on embedded platforms */
+  COMP *wshift = (COMP *)malloc(FFT_ENC * sizeof(COMP));
   int i, j;
   int m_pitch = c2const->m_pitch;
   int nw = c2const->nw;
@@ -155,7 +156,7 @@ void make_analysis_window(C2CONST *c2const, codec2_fft_cfg fft_fwd_cfg,
        nw/2              nw/2
   */
 
-  COMP temp[FFT_ENC];
+  COMP *temp = (COMP *)malloc(FFT_ENC * sizeof(COMP));
 
   for (i = 0; i < FFT_ENC; i++) {
     wshift[i].real = 0.0;
@@ -194,6 +195,8 @@ void make_analysis_window(C2CONST *c2const, codec2_fft_cfg fft_fwd_cfg,
     W[i] = temp[i + FFT_ENC / 2].real;
     W[i + FFT_ENC / 2] = temp[i].real;
   }
+  free(wshift);
+  free(temp);
 }
 
 /*---------------------------------------------------------------------------*\
